# Мульти-агентная система на базе модели Mistral

Платформа для создания мульти-агентной системы на основе модели Mistral, обеспечивающая маршрутизацию запросов между специализированными агентами, контекстную обработку диалогов и автоматическое улучшение агентов на основе анализа пользовательских взаимодействий.

## Описание

Данная система объединяет различные компоненты для создания интеллектуальной платформы обработки запросов пользователей:

- API-сервер оркестратора для маршрутизации запросов
- Клиент Mistral для взаимодействия с LLM-моделью
- Система управления агентами для распределения запросов по специализациям
- Менеджер диалогов для сохранения контекста взаимодействия с пользователями
- Система аналитики агентов для анализа эффективности и генерации улучшений
- Автоматический цикл улучшения агентов на основе реальных диалогов
- Интеграция с Telegram для обеспечения удобного интерфейса взаимодействия

## Статус разработки и тестирования

> **Важно:** Текущая версия системы протестирована только на macOS. Развертывание на серверах Linux находится в процессе тестирования и будет доступно в ближайших релизах.

- ✅ Работа на macOS (проверено)
- ⏳ Работа на серверах Linux (в процессе тестирования)
- ✅ Интеграция с Telegram Bot API
- ✅ Взаимодействие с моделью Mistral
- ✅ Маршрутизация запросов между агентами через LangChain
- ✅ Система контроля таймаутов и обработки ошибок
- ✅ Сбор и анализ пользовательских взаимодействий
- ✅ Автоматическое улучшение агентов на основе анализа диалогов
- ⏳ Поддержка голосовых сообщений (в разработке)

## Архитектура

Система состоит из следующих основных компонентов:

1. **API-сервер оркестратора** - центральный компонент, обрабатывающий входящие запросы и маршрутизирующий их между агентами
2. **Модуль управления агентами** - отвечает за регистрацию, поиск и маршрутизацию запросов к специализированным агентам
3. **Клиент Mistral** - обеспечивает взаимодействие с моделью Mistral через HTTP-запросы
4. **Менеджер диалогов** - хранит историю сообщений пользователей и обеспечивает контекстную обработку
5. **Система аналитики агентов** - анализирует взаимодействия пользователей с агентами и выявляет паттерны и проблемы
6. **Модуль оптимизации агентов** - генерирует улучшения для агентов на основе анализа собранных данных
7. **Модуль тестирования агентов** - проверяет качество улучшений перед их внедрением
8. **Telegram-бот** - предоставляет удобный интерфейс взаимодействия с пользователями

## Виды агентов

В системе реализованы следующие специализированные агенты:

- **Основной ассистент** - универсальный агент для общих вопросов
- **Python-ассистент** - специалист по языку программирования Python
- **Математический ассистент** - эксперт по математическим задачам и вычислениям

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/Dizolot/mistral-multi-agent-system.git
cd mistral-multi-agent-system
```

2. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env файл, указав необходимые параметры
```

3. Запустите скрипт установки:
```bash
./setup.sh
```

4. Запустите все компоненты системы:
```bash
./run_all.sh
```

Для раздельного запуска компонентов можно использовать:
- `python run_api_server.py` - запуск только API-сервера
- `python run_telegram_bot_with_langchain.py` - запуск Telegram-бота с интеграцией LangChain
- `python run_auto_improvement_cycle.py` - запуск цикла автоматического улучшения агентов

## Особенности и ограничения

- Система оснащена механизмом контроля таймаутов, который автоматически отменяет запросы, если они выполняются дольше установленного времени (по умолчанию 10 минут)
- Телеграм-бот показывает статус выполнения запроса в реальном времени, включая время ожидания
- Поддерживаются два режима работы: через оркестратор (с маршрутизацией между агентами) и прямой режим (напрямую через модель)
- Автоматический цикл улучшения агентов анализирует реальные диалоги и генерирует улучшения
- Перед внедрением улучшений система проводит тестирование на наборах данных, созданных из реальных диалогов

## API Endpoints

### Основные эндпоинты:

- `GET /health` - проверка работоспособности сервера
- `GET /agents` - получение списка доступных агентов
- `POST /process` - обработка сообщения от телеграм-бота
- `POST /message` - прямая обработка сообщения от клиента
- `POST /tasks` - создание асинхронной задачи
- `GET /tasks/{task_id}` - получение статуса задачи
- `DELETE /tasks/{task_id}` - отмена задачи

## Автоматическое улучшение агентов

Система поддерживает автоматический цикл улучшения агентов на основе анализа реальных диалогов:

1. **Сбор данных** - сохранение истории взаимодействий пользователей с агентами
2. **Анализ** - выявление паттернов, проблем и возможных улучшений
3. **Генерация улучшений** - создание оптимизированных версий агентов
4. **Тестирование** - проверка улучшений на тестовых наборах данных
5. **Внедрение** - применение успешных улучшений в производственной среде

Для запуска цикла автоматического улучшения:

```bash
python run_auto_improvement_cycle.py --process-all-users --deploy-improvements
```

## Разработка и расширение

### Добавление нового агента

Для добавления нового агента необходимо зарегистрировать его в системе управления агентами:

```python
from multi_agent_system.agents import Agent, agent_manager

# Создаем нового агента
new_agent = Agent(
    agent_id="my_agent",
    name="Мой специализированный агент",
    description="Описание возможностей агента",
    system_prompt="Системный промпт, определяющий роль и поведение",
    keywords=["ключевое_слово1", "ключевое_слово2"]
)

# Регистрируем агента
agent_manager.register_agent(new_agent)
```

## Лицензия

[MIT License](LICENSE) 